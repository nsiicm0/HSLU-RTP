---
title: "Exercise 6"
author: Niclas Simmler
date: 02.04.20
output: html_notebook
---
```{r}
library(forecast)
```
# Exercise 6.1
We visit the analysis of the yield of a chemical process and will have a look at the http://stat.ethz.ch/Teaching/Datasets/WBL/yields.dat time series and its autocorrelations.

```{r}
yields <- read.table("http://stat.ethz.ch/Teaching/Datasets/WBL/yields.dat", header = FALSE)
t.yields <- ts(yields[, 1])
```

## a)
Could these data be generated by an AR-process? If yes, what is the order p?
```{r}
tsdisplay(t.yields)

p <- 1
```
Given that the ACF plot decays quickly and exhibits the form of a damped sinusoid, plus the PACF plot is showing a cutoff at lag 1, I would say, yes the data can be generated by an AR(1) process.

## b)
Using the autocorrelations, compute the Yule-Walker estimate of $\alpha$ by hand. Recall the Yule-Walker equation for the estimated autocorrelation function at lag 1 reads:
$$\hat{\rho}(1) = \alpha \cdot \hat{\rho}(0)$$
Furthermore, find the estimated mean $\hat{\mu}_X$ as well as the innovation variance $\hat{\sigma}^2$.

```{r}
r.yw <- ar(t.yields, method = "yw", order.max = p)
# Calculating alpha
alpha <- r.yw$ar
alpha
# Calculate mu
mu <- r.yw$x.mean
mu
# Calculate sigma
sigma <- r.yw$var.pred
sigma

tsdisplay(r.yw$resid)
```
There does not seem to be any structure within the residuals. Additionally, the (P)ACF plots show that all lags are within the band. Which means we are looking at white noise in the residuals, which is what we want to be confident that our model most likely fits well.

## c)
Use the Burg method to compute the parameters of the AR model. Check its residuals.
```{r}
r.burg <- ar(t.yields, method = "burg", order.max = p)
# Calculating alpha
alpha <- r.burg$ar
alpha
# Calculate mu
mu <- r.burg$x.mean
mu
# Calculate sigma
sigma <- r.burg$var.pred
sigma

tsdisplay(r.burg$resid)
```
Again, there does not seem to be any structure within the residuals. Additionally, the (P)ACF plots show that all lags are within the band. Which means we are looking at white noise in the residuals, which is what we want to be confident that our model most likely fits well.

## d)
Use Maximum Likelihood to estimate these parameters.
```{r}
r.mle <- ar(t.yields, method = "mle", order.max = p)
# Calculating alpha
alpha <- r.mle$ar
alpha
# Calculate mu
mu <- r.mle$x.mean
mu
# Calculate sigma
sigma <- r.mle$var.pred
sigma

tsdisplay(r.mle$resid)
```
Again, there does not seem to be any structure within the residuals. Additionally, the (P)ACF plots show that all lags are within the band. Which means we are looking at white noise in the residuals, which is what we want to be confident that our model most likely fits well.

# Exercise 6.2
In this exercise we examine measurements of the vertical force acting on a cylinder in a water tank. A total of 320 measurements were taken at intervals of 0.15 seconds. Load the data from http://stat.ethz.ch/Teaching/Datasets/WBL/kraft.dat and convert them to a time series.
```{r}
d.force <- read.table("http://stat.ethz.ch/Teaching/Datasets/WBL/kraft.dat", header = FALSE)
ts.force <- ts(d.force[, 1])
```
It is already known that at the time of the experiment, the water in the tank formed waves with (randomly changing) periods of around 2 seconds.

## a)
Create a subset of the data containing only the first 280 observations:
```{r}
ts.forceA <- window(ts.force, end = 280)
tsdisplay(ts.forceA)
```
Is a periodic behaviour to be expected in these data? If so, what should the period be? Does the plot of the times series agree with your expectations?

Given that the water in the tank forms waves periods around 2 seconds and the measurments to be taken every 0.15 second, I would assume a period with $t = 14$ roughly.
Looking at the ACF plot, we can see a positive peak at lag 15, which indicates a period of length $t = 14$.

## b)
Suppose you would like to fit the time series ts.forceA by an AR(p) model. Which order p should this model have?
Choose a suitable order once by looking at the partial autocorrelations, and once by using the Akaike information criterion (AIC).

By looking at the PACF plot, I would guess a suitable value for $p$ could be 6.
```{r}
ar.force <- ar(ts.forceA, method = "burg")
plot(0:ar.force$order.max, ar.force$aic, type='l')
```
The AIC shows a strong kink at lag 6, so I guess this supports the theory derived from the PACF plot that this is an AR(6) process.
```{r}
p <- 6
```

## c)
Fit an AR(p) model using maximum likelihood for the time series ts.forceA, where p is the order specified in Part b). Analyze the residuals. Is the model appropriate for this time series?
```{r}
ar.force <- arima(ts.forceA, order = c(p,0,0), method = 'ML')
tsdisplay(ar.force$resid)
```
The residuals look like white noise, and the (P)ACF plots show a more or less random behavior, which means that this might indeed be white noise. Thus, choosing a p of 6 might be the correct parameter for p.

Let's see how the residuals fit the data.
```{r}
plot(ts.forceA)
lines(ts.forceA - ar.force$resid, col='red')
```
Looks pretty good. Let's see in the next step whether the predictions are good too or the model is overfitted.

## d)
Use the model fitted in Part c) to compute point predictions and prediction intervals for the next 40 measurements. Compare these graphically to the actual measurements.
Then, plot the point predictions and the confidence intervals into the plot using lines(); consult the R help to find out how to get these estimates out of the object force.pred.
```{r}
force.pred <- predict(ar.force, n.ahead=40,return_conf_int=True,alpha=0.05)

plot(window(ts.force, start=250))
lines(force.pred$pred, col='blue')
lines(force.pred$pred - 2*force.pred$se, type = "l", col = 'magenta', lty = 2)
lines(force.pred$pred + 2*force.pred$se, type = "l", col = 'magenta', lty = 2)
```
The prediction (in blue) looks pretty good for the data. In magenta we can see the confidence intervals.
After all it looks that our model modelling an AR(6) process is pretty good.